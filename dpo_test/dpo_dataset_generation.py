from chatgpt_openai.dpo_dataset import DPO
import json


def main():
    # Context about Admiral Yi Sun-sin
    context = """
    국내를 넘어 세계적으로 살펴보아도 이름을 떨친 호레이쇼 넬슨 같은 명장들은 모두 정부의 많은 지원을 받고 전쟁에서 승리했다. 그러나 이순신은 정부와 외부에서 아무런 지원도 받지 못한 채 오히려 반대로 이순신이 정부와 명나라 육군에게 식량, 무기, 종이, 부채, 조총 등 각종 물자와 진상품을 지원해야 하는 것도 모자라 몰려드는 피난민들의 생계까지 직접 돌보면서 힘겹고 외롭게 전쟁을 수행해야 했다. 심지어 권율 휘하의 육군이 허락도 없이 이순신이 어렵게 마련한 수군이 먹을 식량을 시도 때도 없이 징발하고 수군 병력을 마음대로 빼내어 육군으로 편입시키는 그야말로 최악의 상황 속에서도 좌절하지 않고 오직 자신의 노력만으로 자급자족했으며, 휴전기 당시 수군 기지에 전염병이 크게 퍼져 막대한 병력 손실을 입었음에도 아픈 몸을 이끌고 군비를 꾸준히 확장하여 최강의 함대를 만들었다. 그리하여 7년간 수군을 이끌고 뛰어난 지략과 용맹함을 발휘하여 모든 전투에서 승리한 끝에 군함을 단 한 척도 잃지 않고 23전 23승 불패의 신화라는 역사상 유례가 없는 전무후무한 기적을 이뤄냈다.
    이순신은 제해권을 장악하여 전쟁에서 가장 핵심이 되는 적의 보급을 완벽히 차단함으로써 전쟁의 흐름 자체를 바꿔 망국으로 치닫는 나라를 구해낸 불세출의 명장이다.[18] 특히 임진왜란 초기 2차 출동 당시 첫 해전이었던 사천 해전에서 전투를 지휘하다가 적이 쏜 총탄에 왼쪽 어깨를 관통당해 중상을 입는 큰 부상을 당하여 피가 발꿈치까지 흐르는 상황임에도 전투가 끝날 때까지 고통스러운 기색도 없이 아무렇지 않은 듯 태연하게 지휘하여 적의 함대를 전멸시켰으며, 칼로 살을 찢어 박혀 있는 탄환을 제거한 뒤 부하들과 평소처럼 담소를 나눴다고 한다. 명량에서 단 12척의 함대로 일본군을 대파하여 나라를 구했으며 임진왜란 마지막 전투 노량해전에서 명나라 수군도독 진린과 함께 조선에서 철수하는 일본군 함대 500척을 맞아 최후의 일전을 펼쳤다. 이 해전에서 이순신은 바람을 이용한 화공전술을 펼쳐 적선 200척을 격파하고 100척을 포획하였으며 일본군 수만 명을 섬멸하는 큰 전과를 올렸다. 그러나 날이 밝아 올 무렵 적이 쏜 총탄에 맞아 장렬한 최후를 맞았다.
    """

    # Initialize DPO and generate data
    dpo = DPO()
    data = dpo._generate(context=context)

    # Parse and print the generated data
    try:
        parsed_data = json.loads(data)
    except json.JSONDecodeError:
        print("Failed to parse JSON response")
        parsed_data = {"error": "Invalid JSON response"}
    print(json.dumps(parsed_data, indent=2, ensure_ascii=False))


if __name__ == "__main__":
    main()
